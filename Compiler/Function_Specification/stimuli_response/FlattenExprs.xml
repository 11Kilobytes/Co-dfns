<?xml version="1.0" encoding="utf-8" ?>

<section xmlns="http://docbook.org/ns/docbook" version="5.0" xmlns:xi="http://www.w3.org/2001/XInclude">
  <title>Expression Flattening</title>
  <para>
    The <function>FlattenExprs</function> component takes in the AST delivered by 
    <function>Lift Functions</function> and flattens out expressions from their 
    nested representation to a flat representation.
  </para>
  <table frame="void" rules="rows">
    <caption>Stimuli for FlattenExprs</caption>
    <thead>
      <tr>
        <th>Symbol</th>
        <th colspan="2">Name</th>
        <th colspan="4">Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>B</td>
        <td colspan="2">Binding Expression</td>
        <td colspan="4">
          Some binding from expression to expression
        </td>
      </tr>
      <tr>
        <td>A</td>
        <td colspan="2">Atomic Expression</td>
        <td colspan="4">
          An atomic, self-contain expression
        </td>
      </tr>
      <tr>
        <td>D</td>
        <td colspan="2">Dyadic Expression</td>
        <td colspan="4">
          A dyadic expression
        </td>
      </tr>
      <tr>
        <td>M</td>
        <td colspan="2">Monadic Expression</td>
        <td colspan="4">
          A Monadic array expression
        </td>
      </tr>
      <tr>
        <td>O</td>
        <td colspan="2">Other</td>
        <td colspan="4">
          Any other node in the AST
        </td>
      </tr>
    </tbody>
  </table>
  <para>
    We need a few concepts for our responses. The first is a frame, which is 
    basically some specific stack. You can push frames and push to the top frame 
    as a stack. You can pop the current stack, which means that it will be read 
    off LIFO to the output stream. Finally, we can generate new names. 
  </para>
  <table frame="void" rules="rows">
    <caption>Responses for FlattenExprs</caption>
    <thead>
      <tr>
        <th>Symbol</th>
        <th colspan="4">Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Frame</td>
        <td colspan="4">
          Start a new frame
        </td>
      </tr>
      <tr>
        <td>Pop</td>
        <td colspan="4">
          Read out the current stack frame from last to first
        </td>
      </tr>
      <tr>
        <td>Push</td>
        <td colspan="4">
          Push a node to the current stack
        </td>
      </tr>
      <tr>
        <td>Gensym</td>
        <td colspan="4">
          Generate a unique variable and push to the stack
        </td>
      </tr>
      <tr>
        <td>Bind</td>
        <td colspan="4">
          Create a new binding
        </td>
      </tr>
      <tr>
        <td>Id</td>
        <td colspan="4">
          Pass the node through without changing it
        </td>
      </tr>
    </tbody>
  </table>
</section>