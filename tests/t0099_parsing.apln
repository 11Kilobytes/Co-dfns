:Namespace t0099_parsing

TAP←{⍺←⊢ ⋄ (0∊∊⍵)∨0=≢⍵:⍺ ⎕SIGNAL 8 ⋄ _←0⊣⎕←'ok - '⍪(4+⊃⍸'TAP'⍷x)↓x←(⎕CR'TEST')[1⊃⎕LC;]}

∇{Z}←PARSE X
 (p d t k n lx pos end)(xn xt)sym IN←##.codfns.(PS TK) src←X
 Z←1
∇

∇Z←NS src
 Z←(⊂':Namespace'),src,⊂':EndNamespace'
∇

∇{Z}←TEST;src;p;d;t;k;n;lx;pos;end;xn;xt;sym;IN;CD
 Z←⍪⍬
 
 CD←##.codfns
 
 TAP PARSE NS '∇FN' '∇'
 TAP t=CD.(F T H)
 TAP p d=(0 0 1)(0 1 2)
 TAP k=0 1 0
 TAP n=0 (-sym⍳⊂'FN') 0
 TAP lx=4 0 0
 TAP pos end=(0 11 12)(30 16 14)
 TAP xn xt≡¨(,⊂'FN')(,1)
 ⎕←''
 
 TAP PARSE NS '∇FN X' '∇'
 TAP t=CD.(F T H V)
 TAP p d=(0 0 1 2)(0 1 2 3)
 TAP k=0 2 1 1
 TAP n=0 (-sym⍳⊂'FN')0(-sym⍳⊂,'X')
 TAP lx=4 0 0 1
 TAP pos end=(0 11 12 15)(32 18 16 16)
 TAP xn xt≡¨(,⊂'FN')(,2)
 ⎕←''
 
 TAP PARSE NS '∇X FN Y' '∇'
 TAP t=CD.(F T H V V)
 TAP p d=(0 0 1 2 2)(0 1 2 3 3)
 TAP k=0 2 4 1 1
 TAP n=0 (-sym⍳⊂'FN')0,-sym⍳,¨'XY'
 TAP lx=4 0 0 1 1
 TAP pos end=(0 11 12 12 17)(34 20 18 13 18)
 TAP xn xt≡¨(,⊂'FN')(,2)
 ⎕←''
 
 TAP PARSE NS '∇Z←FN' '∇'
 TAP t=CD.(F T H V)
 TAP p d=(0 0 1 2)(0 1 2 3)
 TAP k=0 1 9 1
 TAP n=0 (-sym⍳⊂'FN')0(-sym⍳⊂,'Z')
 TAP lx=4 0 0 1
 TAP pos end=(0 11 12 12)(32 18 16 13)
 TAP xn xt≡¨(,⊂'FN')(,1)
 ⎕←''
 
 TAP PARSE NS '∇Z←FN X' '∇'
 TAP t=CD.(F T H V V)
 TAP p d=(0 0 1 2 2)(0 1 2 3 3)
 TAP k=0 2 10 1 1
 TAP n=0 (-sym⍳⊂'FN')0,-sym⍳,¨'ZX'
 TAP lx=4 0 0 1 1
 TAP pos end=(0 11 12 12 17)(34 20 18 13 18)
 TAP xn xt≡¨(,⊂'FN')(,2)
 ⎕←''
 
 TAP PARSE NS '∇Z←X FN Y' '∇'
 TAP t=CD.(F T H V V V)
 TAP p d=(0 0 1 2 2 2)(0 1 2 3 3 3)
 TAP k=0 2 13 1 1 1
 TAP n=0 (-sym⍳⊂'FN')0,-sym⍳,¨'ZXY'
 TAP lx=4 0 0 1 1 1
 TAP pos end=(0 11 12 12 14 19)(36 22 20 13 15 20)
 TAP xn xt≡¨(,⊂'FN')(,2)
 ⎕←''

 TAP PARSE NS '∇(L FN)Y' '∇'
 TAP t=CD.(F T H V V)
 TAP p d=(0 0 1 2 2)(0 1 2 3 3)
 TAP k=0 3 28 2 1
 TAP n=0 (-sym⍳⊂'FN')0,-sym⍳,¨'LY'
 TAP lx=4 0 0 1 1
 TAP pos end=(0 11 12 13 18)(35 21 19 14 19)
 TAP xn xt≡¨(,⊂'FN')(,3)
 ⎕←''

 TAP PARSE NS '∇X(L FN)Y' '∇'
 TAP t=CD.(F T H V V V)
 TAP p d=(0 0 1 2 2 2)(0 1 2 3 3 3)
 TAP k=0 3 31 1 2 1
 TAP n=0 (-sym⍳⊂'FN')0,-sym⍳,¨'XLY'
 TAP lx=4 0 0 1 1 1
 TAP pos end=(0 11 12 12 14 19)(36 22 20 13 15 20)
 TAP xn xt≡¨(,⊂'FN')(,3)
 ⎕←''

 TAP PARSE NS '∇Z←X(L FN)Y' '∇'
 TAP t=CD.(F T H V V V V)
 TAP p d=(0 0 1 2 2 2 2)(0 1 2 3 3 3 3)
 TAP k=0 3 40 1 1 2 1
 TAP n=0 (-sym⍳⊂'FN')0,-sym⍳,¨'ZXLY'
 TAP lx=4 0 0 1 1 1 1
 TAP pos end=(0 11 12 12 14 16 21)(38 24 22 13 15 17 22)
 TAP xn xt≡¨(,⊂'FN')(,3)
 ⎕←''

∇

:EndNamespace